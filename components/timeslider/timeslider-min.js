define(["css!./timeslider"],function(){TimeSlider=function(e,t){function h(){var t='<div class="time-slider"><div class="left scroll"><div class="ui-icon ui-icon-arrow-l"/></div><div class="slider-container"><div class="slider"><div class="gripper"></div></div></div><div class="right scroll"><div class="ui-icon ui-icon-arrow-r"/></div></div>',n=$(t);e.append(n);s.root=n;s.slider=s.root.find(".slider");s.gripper=s.root.find(".gripper");var r={};r.width=Math.floor(s.slider.innerHeight()*.6);r.height=r.width;r.top=(s.slider.innerHeight()-r.height)/2;r.right=r.top;s.gripper.css(r);s.slider.on("doubletap",function(e){isFunction(i.sliderDblClicked)&&i.sliderDblClicked()});s.root.on("removed",function(){Notifications.off(".timeslider");$(window).off(".timeslider");$(document).off(".timeslider")});Notifications.on("updateUI.timeslider",function(){c||v(300);l=!1})}function p(e){function t(){isFunction(i.scroll)&&i.scroll(e)}f==null&&(f=setInterval(t,80))}function d(){f!=null&&clearInterval(f);f=null}function v(e){var t=s.slider,n=t.parent();console.log("Positioning slider, parent size: "+n.innerWidth());var r=n.innerWidth()/a,i={};i.left=o*r;i.width=u*r;e!=undefined&&e?t.transition(i,e,"easeInOutBack"):t.css(i)}function m(){function e(e){p(e);$(document).on(isTouch()?"touchend.timeslider":"mouseup.timeslider",function(){d();$(document).off(".timeslider")})}s.root.find(".scroll.left").on(isTouch()?"touchstart":"mousedown",function(){e(-1)});s.root.find(".scroll.right").on(isTouch()?"touchstart":"mousedown",function(){e(1)})}function g(){var e=s.slider,t=e.parent();e.on(isTouch()?"touchstart":"mousedown",function(n){var r=n.originalEvent.pageX-e.offset().left,f=e.outerWidth()-r;n.preventDefault();var l=r<e.innerWidth()-e.innerHeight();$(document).on("mousemove.timeslider touchmove.timeslider",function(n){c=!0;var h=e.position().left,v=e.outerWidth(),m={},g=s.root.find(".left").outerWidth(),y=s.root.find(".right").outerWidth();if(l){h=n.originalEvent.pageX-t.offset().left-r;h=Math.max(h,-g);h=Math.min(h,t.innerWidth()-e.outerWidth()+g);e.css({left:h});h<0?p(-1):h+v>t.innerWidth()?p(1):d()}else{v=n.originalEvent.pageX-t.offset().left-e.position().left+f;v=Math.max(v,e.innerHeight()*1.5);v=Math.min(v,t.innerWidth()-e.position().left+y);e.css({width:v})}var b,w=e.parent().innerWidth();b=Math.floor(v/w*a+.5);b=Math.max(b,1);var E;E=Math.floor(h/w*a+.5);E=Math.min(E,a-b);E=Math.max(E,0);if(E!=o){o=E;isFunction(i.positionChanged)&&i.positionChanged()}if(b!=u){u=b;isFunction(i.lengthChanged)&&i.lengthChanged()}});$(document).on("mouseup.timeslider touchend.timeslider",function(e){v(300);d();$(document).off(".timeslider");l=!1;c=!1})})}var n=this,r={appendTo:$("body"),ticks:14,scroll:null,lengthChanged:null,positionChanged:null,rangeChanged:null,sliderDblClicked:null},i=$.extend({},r,t),s={},o=0,u=1,a=14,f=null,l=!0,c=!1;this.position=function(e){if(e==undefined)return o;l=!0;return o=e};this.range=function(e){if(e==undefined)return a;l=!0;return a=e};this.length=function(e){if(e==undefined)return u;l=!0;return u=e};this.positionSlider=v;this.positionGripper=function(){var e={};e.width=Math.floor(s.slider.innerHeight()*.6);e.height=e.width;e.top=(s.slider.innerHeight()-e.height)/2;e.right=e.top;s.gripper.css(e)};this.element=function(){return s.root};h();g();m()};return TimeSlider});