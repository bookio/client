(function(){var e=["css!./main","../../components/msgbox/msgbox","../../components/notify/notify","../../components/desktop/desktop","../../components/timeslider/timeslider","../../components/timescale/timescale","../../widgets/pagelogo/pagelogo","../../widgets/datepicker/datepicker"];define(e,function(){function e(e){function a(e,r){t.is(":visible")&&(o.getTime()!=e.getTime()||u.getTime()!=r.getTime())&&(e.getFullYear()==r.addDays(-1).getFullYear()&&e.getMonth()==r.addDays(-1).getMonth()&&e.getDate()==r.addDays(-1).getDate()?Notify.show(e.getFriendlyDate(),e.getYear()):Notify.show(e.getFriendlyDate()+" - "+r.addDays(-1).getFriendlyDate(),e.getYear()));n.startdate.year.text(sprintf("%04d",e.getFullYear()));n.startdate.day.text(e.getDate()+" "+e.getShortMonthName());n.startdate.weekday.text(e.getShortDayName());var i=r.addDays(-1);n.enddate.year.text(sprintf("%04d",i.getFullYear()));n.enddate.day.text(i.getDate()+" "+i.getShortMonthName());n.enddate.weekday.text(i.getShortDayName());o=e;u=r}function f(){Notifications.trigger("updateUI")}function l(){var e=Math.floor(s.element().innerWidth()/80);s.range(e);i.endDate(i.startDate().addDays(s.range()));h()}function c(){s.position(0);s.length(1);var e=new Date;e.clearTime();i.startDate(e);i.endDate(e.addDays(s.range()));h()}function h(){var e=i.startDate().addDays(s.position()),t=e.addDays(s.length());r.startDate(e);r.endDate(t);s.positionGripper();a(e,t);f()}function p(){var e=o.clone(),t=e.addDays(s.length()),n=e.addDays(-1*s.position()),u=n.addDays(s.range());r.startDate(e);r.endDate(t);i.startDate(n);i.endDate(u);a(e,t);f()}function d(){var e=u.addDays(1),t=e.addDays(-1*s.length()),n=t.addDays(-1*s.position()),o=n.addDays(s.range());r.startDate(t);r.endDate(e);i.startDate(n);i.endDate(o);a(t,e);f()}function v(e){i.scroll(e);h()}function m(e,t,n){var r=$('<div data-role="popup"/>').popup({dismissible:!0,theme:"c",transition:"pop",positionTo:e}),i=$('<div data-role="datepicker"/>').appendTo(r).datepicker();r.on("popupafterclose",function(){$(this).remove()});i.on("datechanged",function(){r.popup("close");n(i.datepicker("getDate"))});r.popup("open")}function g(){t.hookup(n,"data-id");r=new Desktop(n.desktop,{page:t});r.editMode(!1);n.editmode.on("tap",function(){r.editMode(!r.editMode());n.popup.content.popup("close")});n.logout.on("tap",function(){t.on("pagehide",function(e,t){$(this).remove()});$.mobile.pages.push("../login/login.html",{transition:"fade"})});n.settings.on("tap",function(){$.mobile.pages.push("../settings/settings.html",{transition:"fade"})});n.popup.menu.on("tap",function(){var e={dismissible:!0,theme:"c",overlyaTheme:"a",transition:"pop",positionTo:$(this)};n.popup.content.popup(e);n.popup.content.popup("open")});s=new TimeSlider(n.slider,{scroll:v,positionChanged:h,lengthChanged:h,sliderDblClicked:c});s.range(10);i=new TimeScale(n.scale,{});n.startdate.button.on("tap",function(e){e.preventDefault();m($(this),o,function(e){o=e;p()})});n.enddate.button.on("tap",function(e){e.preventDefault();m($(this),u,function(e){u=e;d()})});t.trigger("updatelayout")}var t=e,n={},r=null,i=null,s=null,o=new Date,u=new Date;$(window).smartresize(function(){l()});g();t.on("pageshow",function(e){l()})}$(document).on("pageinit","#main-page",function(t){new e($(t.currentTarget))})})})();